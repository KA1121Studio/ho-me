# YouTubeポータル（学習用） — リポジトリ完全ガイド

このリポジトリは、YouTube Data API を使った学習用ポータルのフロントエンド実装。  
単一ページで「ホーム（人気）」「検索」「動画再生」「チャンネル表示」「コメント（読み込み）」を行う。  
元のワンファイル実装を GitHub 管理しやすい構成に分割し、**APIキーだけを外部ファイル（`js/config.js`）に分離**する設計にしてある。

> 注意: このプロジェクトはクライアントサイドで YouTube Data API を直接呼ぶ形になっているため、APIキーの扱いに十分注意すること。  
> セキュリティ上のより安全な方法（サーバーサイドでプロキシする等）を推奨する。以下に詳述。

---

## 目次

- プロジェクト構成
- 必要条件
- 速攻セットアップ（ローカルで動かす手順）
- `js/config.js` に API キーを入れる方法（推奨設定・例）
- セキュリティと運用上の注意（必読）
- GitHub にあげるときの設定（`.gitignore` 等）
- GitHub Pages で公開するときの注意点
- 開発とデバッグのコツ
- よくあるエラーと対処法
- ファイル詳細説明
- デプロイ / CI のヒント
- 貢献方法・ライセンス
- FAQ

---

## プロジェクト構成

project/
├─ index.html       # パスワード画面とメインコンテンツ
├─ css/
│  └─ style.css     # すべてのスタイル
├─ js/
│  ├─ config.js     # APIキーだけ（ローカルで作成、.gitignore推奨）
│  ├─ main.js       # ルーティング、UI、API呼び出しロジック
│  └─ password.js   # パスワード画面処理
├─ assets/          # 任意の画像やアイコン
├─ .gitignore
└─ README.md

---

## 必要条件

- モダンブラウザ（ES Modules をサポートするブラウザ）
- ローカルで動かす場合はローカルサーバ推奨（`file://` だとモジュール読み込みや CORS に制約が出る）
  - 例: `python -m http.server 8000` （Python 3）
- YouTube Data API v3 を有効化した Google Cloud プロジェクトと API キー

---

## 速攻セットアップ（ローカル）

1. リポジトリをクローンまたはファイルを配置
2. プロジェクトルートでローカルサーバを起動（例：Python）
   ```bash
   # Python 3 の場合（プロジェクトのルートで実行）
   python -m http.server 8000
ブラウザで http://localhost:8000 を開く

利用コード（パスワード）を入力してメイン画面を表示

デフォルトの利用コード: manabinotobira

変更したい場合は js/password.js の correctPassword を編集

js/config.js（APIキー専用） の作り方（必須）
このプロジェクトでは API キーを js/config.js にまとめる。公開リポジトリに直接書かないこと。

1) ファイル作成（プロジェクトルートから）
js/config.js を作成して次のように書く：

js
コードをコピーする
// js/config.js
// このファイルは公開リポジトリにコミットしないこと（.gitignore に追加推奨）

export const API_KEYS = [
  'AIzaSy...あなたの最初のAPIキー...',
  // 'AIzaSy...二つ目のキー（任意）...',
];
2) .gitignore に追加（重要）
.gitignore に js/config.js を追加してコミット対象外にする：

bash
コードをコピーする
# APIキーを含むローカル設定ファイル
js/config.js
3) API キーの取得方法（簡易）
Google Cloud Console にアクセス

プロジェクトを作成 / 選択

「API とサービス」→「ライブラリ」で YouTube Data API v3 を有効化

「認証情報」→「API キー」を作成

作成したキーを js/config.js に貼る

4) リファラー（利用制限）設定について
ブラウザで直接使うキーは「アプリケーションの制限: HTTP リファラー（ウェブサイト）」を設定し、使用を許可するドメイン（例: http://localhost:8000 や https://yourdomain.com）だけに絞ること。

誤って公開した場合のリスク軽減に超重要。

セキュリティと運用上の注意（と推奨対策）
リスク
クライアントサイドに置いた API キーは最終的にユーザーのブラウザに渡るため、完全な秘匿は不可能。

悪意あるユーザにキーを使われるとクォータ枯渇や不正利用の恐れあり。

推奨策（順位つき）
リファラー制限を必ず設定する（Google Cloud Console の API キー設定で）。

許可するドメインだけに制限すれば、第三者サイトでキーが使われるのを防げる。

短期的にローカルやプライベートで使う分には config.js + .gitignore の運用でOK。公開サイトでは次の方法を検討：

サーバサイドでプロキシを用意して API 呼び出しをサーバ経由にする。

サーバ側で API キーを保管、クライアントはサーバのエンドポイントを叩く形にすることでキーを秘匿可能。

サーバ側でレート制御、キャッシュ、認証を追加できる。

API 使用量の監視を有効化。クォータや請求が思わぬ影響を及ぼす場合がある。

GitHub Secrets + Actions / CI を利用してビルド時に埋め込む手法もあるが、クライアントに最終的にキーが残るため公開ケースでは注意が必要。

GitHub に上げるとき（運用上の注意）
js/config.js を .gitignore に入れること。サンプルとして js/config.example.js を用意しておくと親切：

js
コードをコピーする
// js/config.example.js
export const API_KEYS = [
  'YOUR_API_KEY_1',
];
README.md に API キーの入れ方を明記しておき、他の開発者が迷わないようにする。

コミット前に git status を確認してキーをコミットしていないかチェックする。

GitHub Pages で公開する場合の注意
GitHub Pages にそのままデプロイしてクライアントサイドで API を呼ぶ場合、config.js をコミットしないと動かない。

つまり公開リポジトリで config.js をコミットすると API キーが公開されてしまうため推奨しない。

対策案：

公開用はサーバプロキシを用意して API を隠蔽する（ベスト）。

どうしてもクライアント直呼びが必要なら、最小権限＋リファラー制限を強く推奨。

GitHub Actions を使ってデプロイ時に config.js を生成する（ただし生成後に公開されるためキーの公開が問題なければ）。通常は公開キーとして安全ではない。

開発・デバッグのコツ
ローカルは必ずローカルサーバで起動する。file:// では ES Module 読込や一部 API 同士の挙動が変わる。

ブラウザの DevTools コンソールに出るエラーメッセージ（HTTP ステータス、レスポンスボディ）をよく確認する。

quotaExceeded や 403 が出たら、まずキーのリファラー設定、API の有効化、使用量を確認する。

ネットワークタブで実際のリクエスト URL（key パラメータ含む）を確認して、期待したキーが入っているかチェック。

API 呼び出しで text を読み取って手動で JSON.parse している箇所があるので、予期しない非JSON応答にも注意する（例：HTML エラーページ）。

よくあるエラーと対処法
1) API keys not configured（画面に表示される）
js/config.js が存在しない、または API_KEYS が空になっている。

対処: js/config.js を作成し、キーを配列で追加する。

2) quotaExceeded / 403 エラー
キーのクォータが尽きたか、制限に引っかかっている。

対処:

Google Cloud Console でクォータ使用量を確認

別キーを用意して API_KEYS に追加

リファラー制限が厳しすぎないか確認

サーバプロキシ化を検討

3) CORS / ネットワークエラー
ブラウザで API に直アクセスする際は通常 CORS 問題は起きないはずだが、プロキシ経由や不正なリクエストだと問題発生。

対処: リクエスト URL とヘッダを確認。サーバプロキシを使う場合はサーバ側で正しくヘッダを返す。

4) モジュール読み込みエラー（type="module"）
index.html を file:// で開いているとモジュール読み込みが失敗することがある。

対処: python -m http.server 等で http サーバを立ててアクセス。

ファイル詳細（役割／要点）
index.html

パスワード画面（#passwordScreen）とメインコンテンツ（#mainContent）を持つ。

js/password.js と js/main.js を type="module" で読み込む形。

css/style.css

全スタイルをまとめたファイル。レスポンシブ対応、再生画面のレイアウト等を含む。

js/config.js（必ず作成）

export const API_KEYS = [...] の形で API キーのみを格納。

リポジトリにコミットしないこと。

js/password.js

パスワード入力のロジック。デフォルト利用コード manabinotobira を使っている。変更可能。

js/main.js

ルーティング、API 呼び出し（apiGet）、UI 描画関数（renderHome, renderWatch, renderChannel 等）を含む。

apiGet は API_KEYS を順次ローテーションして使う実装になっている。

デプロイ / CI のヒント
CI（例: GitHub Actions）でホスティングを自動化する場合、公開先に API キーを置かないことをまず検討する。

推奨ワークフロー:

バックエンド（サーバプロキシ）を用意して API キーはサーバにのみ持たせる。

フロントはサーバのエンドポイントを叩く。サーバで API 呼び出し・キャッシュ・レート制御を行う。

GitHub Actions の秘密はサーバのデプロイ時にのみ使用（サーバ側にシークレットを注入）する。

貢献・開発ルール（案）
js/config.js は常に .gitignore 対象にすること。

変更を PR するときは js/config.example.js を使って再現手順を記載すること。

大きな変更（API 呼び出しロジック、認証方式）を行う場合は Issue を立てて設計を相談すること。

ライセンス案内
このリポジトリは MIT ライセンスを推奨。必要なら LICENSE ファイルを追加して明示すること。

外部ロゴ（例: Google Classroom の SVG）を利用する場合は、その素材のライセンスを確認して使用すること。商用利用や再配布に制限がある場合は注意。

FAQ（よくある質問）
Q: config.js を誤ってコミットしてしまった。どうする？
A: すぐにそのキーを無効化（Google Cloud Console）して新しいキーを発行する。コミット履歴から削除するには git rm --cached js/config.js → .gitignore に追加 → 新しいキーでローカル再作成。履歴から完全削除する場合は git filter-branch や BFG Repo-Cleaner を検討する。

Q: GitHub Pages に公開したいけどキーはどうする？
A: クライアント側に直接キーを置くのは推奨しない。可能ならサーバプロキシを用意してそこ経由で呼ぶ。どうしても公開鍵を置く場合はリファラー制限を厳重に設定すること。

Q: 複数人で開発する場合のキー共有は？
A: 共有しないのが原則。各自ローカルで自分の js/config.js を作るか、開発用の短期間で有効なキーをチーム管理者が発行する。公開リポジトリには絶対に追加しない。

最後に（チェックリスト）
リポジトリを公開する前に次を必ず確認する：

 js/config.js を .gitignore に入れてある

 API キーにリファラー制限をかけている

 YouTube Data API v3 が有効になっている

 README.md にキーの作り方とローカル起動方法が明記されている

 テストで quotaExceeded が起きたときの対応フローをチームに説明してある

